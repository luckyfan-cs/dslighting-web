import{_ as i,c as a,o as n,ag as t}from"./chunks/framework.BHvMP3tD.js";const r=JSON.parse('{"title":"教程：创建自定义 Agent","description":"","frontmatter":{},"headers":[],"relativePath":"api/tutorials/custom-agent.md","filePath":"api/tutorials/custom-agent.md"}'),e={name:"api/tutorials/custom-agent.md"};function l(p,s,h,k,o,d){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="教程-创建自定义-agent" tabindex="-1">教程：创建自定义 Agent <a class="header-anchor" href="#教程-创建自定义-agent" aria-label="Permalink to &quot;教程：创建自定义 Agent&quot;">​</a></h1><p><code>dslighting</code> 的强大之处不仅在于其内置的 <code>aide</code> 和 <code>automind</code> 工作流，更在于其出色的可扩展性。当内置 Agent 无法满足您的特定需求时，您可以轻松创建自己的 Agent。</p><p>本教程将指导您创建一个简单的自定义 Agent，它会读取任务的 <code>intent</code>，并将其写入一个文本文件中。</p><h2 id="_1-agent-的基本结构" tabindex="-1">1. Agent 的基本结构 <a class="header-anchor" href="#_1-agent-的基本结构" aria-label="Permalink to &quot;1. Agent 的基本结构&quot;">​</a></h2><p>在 <code>dslighting</code> 中，所有的 Agent 都继承自 <code>dslighting.Agent</code> 基类。您只需要实现一个核心方法：<code>run()</code>。</p><p>在 <code>run()</code> 方法中，您可以访问以下一些有用的属性：</p><ul><li><strong><code>self.intent</code></strong>: 当前任务的意图字符串。</li><li><strong><code>self.log(message)</code></strong>: 向 <code>dslighting.log</code> 中打印日志。</li><li><strong><code>self.artifact_path</code></strong>: 指向当前任务产物目录的路径 (<code>artifacts/</code>)。您可以将任何结果文件保存在这里。</li><li><strong><code>self.data_path(...)</code></strong>: 获取输入数据的路径。</li></ul><h2 id="_2-编写自定义-agent" tabindex="-1">2. 编写自定义 Agent <a class="header-anchor" href="#_2-编写自定义-agent" aria-label="Permalink to &quot;2. 编写自定义 Agent&quot;">​</a></h2><p>让我们开始编写代码。首先，创建一个名为 <code>custom_agents</code> 的文件夹，并在其中创建一个 <code>my_agent.py</code> 文件。</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># custom_agents/my_agent.py</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dslighting </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Agent</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyCustomAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Agent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    一个简单的自定义 Agent，它将任务的 intent 写入一个文件中。</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 1. 记录一条日志，表明 Agent 已开始工作</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.log(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello from MyCustomAgent! The user&#39;s intent is: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.intent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 2. 定义输出文件的路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        output_file_path </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.artifact_path </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;intent_record.txt&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 3. 将 intent 写入文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(output_file_path, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;w&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            f.write(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.intent)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 4. 记录一条日志，表明任务已完成</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.log(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Successfully wrote the intent to </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output_file_path</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h2 id="_3-使用自定义-agent" tabindex="-1">3. 使用自定义 Agent <a class="header-anchor" href="#_3-使用自定义-agent" aria-label="Permalink to &quot;3. 使用自定义 Agent&quot;">​</a></h2><p>现在我们已经有了自己的 Agent，接下来需要告诉 <code>dslighting</code> 如何找到并使用它。</p><h3 id="a-编写-benchmark-配置" tabindex="-1">a. 编写 Benchmark 配置 <a class="header-anchor" href="#a-编写-benchmark-配置" aria-label="Permalink to &quot;a. 编写 Benchmark 配置&quot;">​</a></h3><p>创建一个 <code>custom_agent_benchmark.yml</code> 文件。在 <code>workflow</code> 字段，我们填入自定义 Agent 的类名的小写蛇形命名（<code>MyCustomAgent</code> -&gt; <code>my_custom_agent</code>）。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># custom_agent_benchmark.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">custom-agent-test</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1.0&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">test-my-agent</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ✨ 这里使用我们自定义的 Agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    workflow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my_custom_agent</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    intent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;This is a test intent for our custom agent.&quot;</span></span></code></pre></div><h3 id="b-编写并运行-python-脚本" tabindex="-1">b. 编写并运行 Python 脚本 <a class="header-anchor" href="#b-编写并运行-python-脚本" aria-label="Permalink to &quot;b. 编写并运行 Python 脚本&quot;">​</a></h3><p>最后，创建 <code>run_custom.py</code>。在调用 <code>dslighting.run()</code> 之前，我们需要使用 <code>dslighting.register_agent()</code> 来注册我们的自定义 Agent。</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># run_custom.py</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dslighting</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> custom_agents.my_agent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MyCustomAgent</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __name__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;__main__&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 注册我们的自定义 Agent</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 第一个参数是 YAML 中使用的名称，第二个参数是 Agent 类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dslighting.register_agent(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my_custom_agent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, MyCustomAgent)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 运行基准测试</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dslighting.run(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;custom_agent_benchmark.yml&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>在终端中运行：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run_custom.py</span></span></code></pre></div><h2 id="_4-验证结果" tabindex="-1">4. 验证结果 <a class="header-anchor" href="#_4-验证结果" aria-label="Permalink to &quot;4. 验证结果&quot;">​</a></h2><p>运行成功后，查看 <code>output/custom-agent-test/</code> 目录。在最新的运行实例中，您会发现：</p><ol><li><p><strong>日志文件 <code>dslighting.log</code></strong> 中包含了我们自定义的日志信息：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>...</span></span>
<span class="line"><span>Hello from MyCustomAgent! The user&#39;s intent is: This is a test intent for our custom agent.</span></span>
<span class="line"><span>Successfully wrote the intent to .../artifacts/intent_record.txt</span></span>
<span class="line"><span>...</span></span></code></pre></div></li><li><p><strong>产物目录 <code>artifacts</code></strong> 中包含了我们生成的文件：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>...</span></span>
<span class="line"><span>└── test-my-agent/</span></span>
<span class="line"><span>    └── artifacts/</span></span>
<span class="line"><span>        └── intent_record.txt</span></span></code></pre></div><p><code>intent_record.txt</code> 的内容正是我们在 YAML 中定义的 <code>intent</code>。</p></li></ol><p>恭喜！您已经成功构建并运行了您的第一个自定义 Agent。基于这个简单的例子，您可以构建更复杂的 Agent 来连接数据库、调用专用 API 或执行任何您需要的自定义逻辑。</p>`,24)])])}const c=i(e,[["render",l]]);export{r as __pageData,c as default};
